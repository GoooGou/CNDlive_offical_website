---
import { ClientRouter } from 'astro:transitions';
import Main from '@/components/Main.astro';
// import Footer from "@/components/Footer.astro";
import Footer from '@/components/Footer.astro';
import '@/styles/global.css';
import Navbar from '@/components/navbar/Navbar.jsx';
import FloatingTools from '@/components/ui/FloatingTools.jsx';
const isHomepage = Astro.url.pathname === '/';
// ğŸ”¥ è¡¥ä¸Šè¿™ä¸€è¡Œå®šä¹‰
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
// src/layouts/Layout.astro
interface Props {
  title: string;
  description?: string;
  image?: string;
  schema?: object; // 1. è¿™é‡Œå®šä¹‰äº†ç±»å‹
}

// 2. ğŸ”¥ å¿…é¡»åœ¨è¿™é‡ŒæŠŠå®ƒè§£æ„å‡ºæ¥ï¼å¦åˆ™ä¸‹é¢å°±ä¼šæŠ¥ "æ‰¾ä¸åˆ°åç§° schema"
const { 
  title, 
  description = "Default description...", 
  image = "/images/default-og.png", 
  schema  // <--- è¡¥ä¸Šè¿™ä¸ª
} = Astro.props;
// æ— è®º image æ˜¯ä¼ è¿›æ¥çš„ï¼Œè¿˜æ˜¯é»˜è®¤çš„ï¼Œéƒ½è½¬æˆç»å¯¹è·¯å¾„
const socialImageURL = new URL(image, Astro.site);
// ğŸ”¥ 1. æŠŠå›ºå®šçš„ "Organization" æ•°æ®å®šä¹‰åœ¨è¿™é‡Œ
const orgSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "CNDLive",
  "url": "https://cndlive.com",
  "logo": "https://cndlive.com/logo.svg", // æ³¨æ„ï¼šæœ€å¥½æ˜¯ç»å¯¹è·¯å¾„
  "sameAs": [
    "https://www.facebook.com/cndlive",
    "https://www.linkedin.com/company/cndlive",
    "https://www.youtube.com/@cndlive"
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "+86-0755-26888079",
    "contactType": "customer support"
  }
};
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Quicksand:wght@300..700&display=swap"
      rel="stylesheet"
    />
    {/* ğŸ”¥ 2. å¯ç”¨è§†å›¾è¿‡æ¸¡ (å¿…é¡»æ”¾åœ¨ head é‡Œ) */}
    <ClientRouter />


    {/* ğŸ”¥ 4. Canonical æ ‡ç­¾ (SEO å¿…å¤‡)ï¼šé˜²æ­¢æœç´¢å¼•æ“è§‰å¾—ä½ æœ‰å¾ˆå¤šé‡å¤é¡µé¢ */}
    <link rel="canonical" href={canonicalURL} />

    {/* --- Open Graph (Facebook, LinkedIn, å¾®ä¿¡ç­‰) --- */}
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={socialImageURL} />

    {/* --- Twitter (X) --- */}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:domain" content={Astro.site?.host} /> {/* å‘Šè¯‰ Twitter ä½ çš„åŸŸå */}
    <meta name="twitter:url" content={Astro.url} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} /> {/* è¡¥ä¸Šæè¿° */}
    <meta name="twitter:image" content={socialImageURL} />

    {/* --- ç»“æ„åŒ–æ•°æ® (Schema) --- */}
    {/* ğŸ”¥ 2. æ¸²æŸ“åŠ¨æ€çš„ Product/Article Schema (å¦‚æœæœ‰çš„è¯) */}
    {schema && (
      <script type="application/ld+json" set:html={JSON.stringify(schema)} />
    )}

    {/* ğŸ”¥ 3. æ¸²æŸ“å›ºå®šçš„ Organization Schema (å…¨ç«™é€šç”¨) */}
    {/* å¿…é¡»ç”¨ set:html={JSON.stringify(...)} è¿™ç§æ–¹å¼ */}
    <script type="application/ld+json" set:html={JSON.stringify(orgSchema)} />
    
    </script>
  </head>
  <body class="flex min-h-screen flex-col text-gray-900 antialiased">
    {/* åªåœ¨é¦–é¡µæ¸²æŸ“è¿™ä¸ªç»„ä»¶ */}
    <div
      id="main-navbar"
      transition:persist
      class="sticky top-0 z-50 h-20 w-full"
    >
      <Navbar client:load />
    </div>
    <main class="relative z-0 grow" transition:animate="fade">
      <slot />
    </main>
    {/* ğŸ”¥ æ”¾åœ¨è¿™é‡Œï¼Œå¹¶ä½¿ç”¨ client:load æ¿€æ´» JS äº¤äº’ */}
    <FloatingTools client:load transition:persist />
    <Footer transition:persist />
  </body>
</html>

<style is:global></style>
