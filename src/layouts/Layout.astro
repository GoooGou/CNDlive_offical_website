---
// src/layouts/Layout.astro
import { ClientRouter } from 'astro:transitions';

import Footer from '@/components/Footer.astro';
import '@/styles/global.css';
import Navbar from '@/components/navbar/Navbar.jsx';
import FloatingTools from '@/components/ui/FloatingTools.jsx';
import '@fontsource-variable/montserrat';
import PromotionBanner from '@/components/ui/PromotionBanner.astro';
import { SITE_CONFIG } from '@/global.config';
import Header from '@/components/navbar/Header.astro';
import ProgressBar from '@/components/common/ProgressBar.astro';
import { Reveal } from '@/components/ui/Reveal';

const SITE_TITLE =
  'CNDLive - Professional Video Streaming Solutions | Encoders & Decoders';
const SITE_DESCRIPTION =
  'CNDLive provides professional video IP transmission solutions...';

// ğŸ—‘ï¸ Keywords å…¶å®å¯ä»¥åˆ äº†ï¼Œç°ä»£ SEO ä¸çœ‹å®ƒï¼Œä¸è¿‡ç•™ç€ä¹Ÿæ— å®³
const SITE_KEYWORDS = 'Video Encoder, Video Decoder, 4K Streaming...';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  schema?: object;
}

const {
  title = SITE_TITLE,
  description = SITE_DESCRIPTION,
  image = '/images/default-og.png', // âš ï¸ å†æ¬¡æé†’ï¼šæ£€æŸ¥ public/images/ ä¸‹æœ‰æ²¡æœ‰è¿™å¼ å›¾ï¼Œå¦åˆ™ build ä¼šæŠ¥ 404
  schema,
} = Astro.props;

// ğŸ›¡ï¸ ä½ çš„è¿™ä¸ªå…œåº•å†™å¾—éå¸¸å¥½ï¼Œå½»åº•é˜²æ­¢äº† astro.config.mjs é…ç½®é”™è¯¯å¯¼è‡´çš„å´©æºƒ
const siteBase = Astro.site || new URL('https://cndlive.com');

const canonicalURL = new URL(Astro.url.pathname, siteBase);
const socialImageURL = new URL(image, siteBase);

const orgSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'CNDLive',
  url: 'https://cndlive.com',
  logo: 'https://cndlive.com/logo.svg',
  sameAs: [
    'https://www.facebook.com/cndlive',
    'https://www.linkedin.com/company/cndlive',
    'https://www.youtube.com/@cndlive',
  ],
  contactPoint: {
    '@type': 'ContactPoint',
    telephone: '+86-0755-26888079',
    contactType: 'customer support',
  },
};
// æ¨å¹¿æ¨ªå¹…æ˜¯å¦æ¿€æ´»
const isActive = true;
// ç¡®ä¿åœ¨ä½ çš„ astro.config.mjs ä¸­è®¾ç½®äº† site: 'https://yourwebsite.com'

// 1. è·å–ç½‘ç«™åŸºç¡€ URL
// Astro.site æ˜¯ä¸€ä¸ª URL å¯¹è±¡ï¼Œæ¥è‡ª astro.config.mjs ä¸­çš„ `site` å±æ€§ã€‚
const siteUrl = Astro.site;

// 2. è·å–å½“å‰é¡µé¢çš„è·¯å¾„ï¼ˆä¾‹å¦‚ /blog/post-title æˆ– /aboutï¼‰
// Astro.url æ˜¯ä¸€ä¸ª URL å¯¹è±¡ï¼ŒåŒ…å«å½“å‰é¡µé¢çš„å®Œæ•´ä¿¡æ¯ã€‚
const pathname = Astro.url.pathname;

// 3. æ„å»ºå®Œæ•´çš„è§„èŒƒ URL
// ä½¿ç”¨ URL æ„é€ å‡½æ•°å®‰å…¨åœ°åˆå¹¶åŸºç¡€URLå’Œè·¯å¾„ã€‚
const canonicalUrl = new URL(pathname, siteUrl).href;

// æ³¨æ„ï¼šå¦‚æœä½ çš„ Astro ç‰ˆæœ¬è¾ƒæ—§ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ‹¼æ¥ï¼š
// const canonicalUrl = `${siteUrl.href.replace(/\/$/, '')}${pathname}`;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <title>{title}</title>
    <!-- é¢„åŠ è½½ Montserrat å­—ä½“ -->
    <link
      rel="preload"
      href="/fonts/montserrat-latin-wght-normal.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <link
      rel="preload"
      href="/fonts/montserrat-latin-wght-italic.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <meta name="description" content={description} />
    <meta name="keywords" content={SITE_KEYWORDS} />

    <ClientRouter />

    <link rel="canonical" href={canonicalURL} />

    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={socialImageURL} />
    <meta property="og:site_name" content="CNDLive" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:domain" content={siteBase.host} />
    <meta name="twitter:url" content={Astro.url} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={socialImageURL} />

    {
      schema && (
        <script type="application/ld+json" set:html={JSON.stringify(schema)} />
      )
    }
    <script type="application/ld+json" set:html={JSON.stringify(orgSchema)} />

    <script is:inline>
      function applyTheme() {
        const storedTheme =
          typeof localStorage !== 'undefined' && localStorage.getItem('theme');
        if (storedTheme === 'light') {
          document.documentElement.classList.remove('dark');
        } else {
          document.documentElement.classList.add('dark');
          if (!storedTheme) {
            localStorage.setItem('theme', 'dark');
          }
        }
      }
      applyTheme();
      document.addEventListener('astro:after-swap', applyTheme);
    </script>
    <link rel="canonical" href={canonicalUrl} />
  </head>

  <body class="text-text-main flex min-h-screen flex-col antialiased">
    <Header transition:persist />

    <main class="relative z-0 grow" transition:animate="fade">
      <ProgressBar />
      <slot />
    </main>

    {/* âœ… å»ºè®®æ”¹ä¸º client:idleï¼Œè®©ä¸»å†…å®¹å…ˆåŠ è½½ï¼Œå·¥å…·æ ç¨ååŠ è½½ï¼Œæå‡æ€§èƒ½ */}
    <FloatingTools client:idle transition:persist />

    <Footer />
  </body>
</html>

<style is:global>
  html,
  body {
    /* å¼ºåˆ¶ç¦æ­¢æ°´å¹³æ»šåŠ¨æ¡ï¼Œå¤šå‡ºçš„å†…å®¹ä¼šè¢«ç›´æ¥åˆ‡æ‰ */
    /* âœ… æ”¹ç”¨è¿™ä¸ªï¼Œæ—¢èƒ½éšè—æ¨ªå‘æ»šåŠ¨æ¡ï¼Œåˆä¸ä¼šç ´å sticky */
    overflow-x: clip;

    /* ç¡®ä¿å®½åº¦ä¸ä¼šè«åå…¶å¦™è¶…å‡º */
    max-width: 100vw;
  }
</style>
