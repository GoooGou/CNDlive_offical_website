---
// src/components/products/DownloadList.astro
import { Icon } from '@astrojs/starlight/components';
// è¯·ç¡®è®¤è¿™äº›è‡ªå®šä¹‰ç»„ä»¶çš„è·¯å¾„
import CalendarSvg from './CalendarSvg.astro';
import DownloadSvg from './DownloadSvg.astro';
// ğŸ”¥ æˆ‘ä»¬å¤ç”¨å·²æœ‰çš„ DownSvg ä½œä¸ºæŠ˜å æŒ‡ç¤ºç®­å¤´ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥å°±æ˜¯ä¸ªå‘ä¸‹ç®­å¤´

interface DownloadItem {
  title: string;
  date?: string;
  fileUrl: string;
  releaseNotes?: string;
}

interface DownloadCategory {
  category: string;
  items: DownloadItem[];
}

interface Props {
  data: DownloadCategory[];
}

const { data } = Astro.props;
---

<div class="not-content mt-8 space-y-8">
  {
    data &&
      data.map((section) => (
        /*
          ğŸ”¥ å…³é”®ä¿®æ”¹ 1: å¤–å±‚å®¹å™¨æ”¹ä¸º <details>
          - group/section: ä¸ºäº†è®©å†…éƒ¨çš„ç®­å¤´å›¾æ ‡èƒ½æ ¹æ®æ‰“å¼€çŠ¶æ€æ—‹è½¬
          - open: é»˜è®¤å±•å¼€æ‰€æœ‰æ¿å—
          - overflow-hidden: ç¡®ä¿åœ†è§’é‡Œçš„å†…å®¹ä¸æº¢å‡º
          - ç§»é™¤äº†åŸæ¥çš„ p-6 paddingï¼Œç§»åˆ° summary å’Œå†…å®¹å†…éƒ¨å»
        */
        <details
          class="group/section overflow-hidden rounded-xl border border-[var(--color-border)] bg-[var(--color-bg-code)] shadow-sm"
          open
        >
          {/*
            ğŸ”¥ å…³é”®ä¿®æ”¹ 2: æ ‡é¢˜æ æ”¹ä¸º <summary>
            - cursor-pointer: é¼ æ ‡æ”¾ä¸Šå»å˜æˆæ‰‹å‹ï¼Œæç¤ºå¯ç‚¹å‡»
            - justify-between: è®©å·¦ä¾§æ ‡é¢˜å’Œå³ä¾§ç®­å¤´åˆ†å±…ä¸¤ç«¯
            - select-none: é˜²æ­¢ç‚¹å‡»æ—¶å¿«é€Ÿé€‰ä¸­æ–‡å­—
            - list-none [&::-webkit-details-marker]:hidden: éšè—æµè§ˆå™¨é»˜è®¤ä¸‘é™‹çš„ä¸‰è§’å½¢æ ‡è®°
            - p-6: è¡¥å›åŸæ¥çš„å†…è¾¹è·
          */}
          <summary class="text-text-main flex cursor-pointer list-none items-center justify-between p-6 text-xl font-bold transition-colors select-none hover:bg-(--color-bg-hover) [&::-webkit-details-marker]:hidden">
            {/* å·¦ä¾§ï¼šå›¾æ ‡ + æ ‡é¢˜æ–‡å­— */}
            <div class="flex items-center gap-2">
              {section.category === 'Firmware' ? (
                <Icon name="seti:config" class="text-primary" />
              ) : (
                <Icon name="document" class="text-primary" />
              )}
              <h3>{section.category}</h3>
            </div>

            {/*
              ğŸ”¥ å…³é”®ä¿®æ”¹ 3: æ·»åŠ å³ä¾§æŒ‡ç¤ºç®­å¤´
              - group-open/section:rotate-180: å½“çˆ¶çº§ details æ‰“å¼€æ—¶ï¼Œæ—‹è½¬180åº¦
            */}
            {/* ğŸ”¥ æ›¿æ¢å›¾æ ‡ä¸º +/- æ–‡æœ¬ (å¤§åˆ†ç±») */}
            <div class="flex h-5 w-5 items-center justify-center text-2xl leading-none font-extrabold text-[var(--color-primary)]">
              <span class="transition-opacity duration-300 group-open/section:hidden">
                {' '}
                +{' '}
              </span>
              <span class="hidden transition-opacity duration-300 group-open/section:inline">
                {' '}
                -{' '}
              </span>
            </div>
          </summary>

          {/* å†…å®¹åŒºåŸŸå®¹å™¨ï¼Œéœ€è¦è¡¥ä¸Š padding */}
          <div class="space-y-4 px-6 pb-6">
            {section.items.map((item) => (
              <div class="group hover:border-primary rounded-lg border border-(--color-border) bg-(--color-bg-base) p-5 shadow-sm transition-all hover:shadow-md">
                <div class="flex flex-col justify-between gap-4 sm:flex-row sm:items-center">
                  {/* å·¦ä¾§ä¿¡æ¯ */}
                  <div>
                    <div class="text-text-main text-base font-bold">
                      {item.title}
                    </div>
                    {item.date && (
                      <div class="text-text-muted mt-1 flex items-center gap-1.5 text-xs">
                        <CalendarSvg class="h-3.5 w-3.5 shrink-0" />
                        Update: {item.date}
                      </div>
                    )}
                  </div>

                  {/* å³ä¾§æŒ‰é’® */}
                  <a
                    href={item.fileUrl}
                    target="_blank"
                    class="flex min-w-[120px] items-center justify-center gap-2 rounded-lg bg-[var(--color-primary)] px-5 py-2.5 text-sm font-bold text-white no-underline shadow-sm transition-transform hover:-translate-y-0.5 hover:shadow-lg active:translate-y-0"
                  >
                    <DownloadSvg class="h-4 w-4 text-white" />
                    Download
                  </a>
                </div>

                {/* Release Notes æŠ˜å åŒºåŸŸ (å†…éƒ¨çš„å°æŠ˜å ä¿æŒä¸å˜) */}
                {item.releaseNotes && (
                  <div class="mt-4 border-t border-dashed border-(--color-border) pt-4">
                    <details class="group/details text-sm">
                      <summary class="text-text-muted hover:text-primary flex w-fit cursor-pointer items-center gap-1.5 font-medium transition-colors select-none">
                        <span class="group-open/details:hidden">
                          View Release Notes
                        </span>
                        <span class="hidden group-open/details:inline">
                          Hide Release Notes
                        </span>
                        {/* ğŸ”¥ æ›¿æ¢å›¾æ ‡ä¸º +/- æ–‡æœ¬ (Release Notes) */}
                        <div class="flex h-3 w-3 items-center justify-center text-base leading-none font-extrabold text-[var(--color-primary)]">
                          <span class="transition-opacity duration-300 group-open/details:hidden">
                            {' '}
                            +{' '}
                          </span>
                          <span class="hidden transition-opacity duration-300 group-open/details:inline">
                            {' '}
                            -{' '}
                          </span>
                        </div>
                      </summary>

                      {/* ä¸‹æ‹‰å†…å®¹ */}
                      <div class="border-primary text-text-muted mt-3 rounded-r-md border-l-2 bg-(--color-bg-code) p-4 leading-7 whitespace-pre-line">
                        {item.releaseNotes}
                      </div>
                    </details>
                  </div>
                )}
              </div>
            ))}
          </div>
        </details>
      ))
  }
</div>
