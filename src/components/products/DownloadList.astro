---
// æ–‡ä»¶è·¯å¾„: src/components/product/DownloadList.astro
import { Icon } from '@astrojs/starlight/components';
import DownSvg from './DownloadSvg.astro';
import CalendarSvg from './CalendarSvg.astro'; // ğŸ‘ˆ 1. å¼•å…¥æ–°ç»„ä»¶

interface DownloadItem {
  title: string;
  date?: string;
  fileUrl: string;
  releaseNotes?: string;
}

interface DownloadCategory {
  category: string;
  items: DownloadItem[];
}

interface Props {
  data: DownloadCategory[];
}

const { data } = Astro.props;
---

<div class="not-content mt-4 space-y-6">
  {
    data &&
      data.map((section) => (
        <div class="rounded-xl border border-zinc-200 bg-zinc-50 p-5 dark:border-zinc-800 dark:bg-zinc-900/30">
          <h3 class="mb-4 flex items-center gap-2 text-lg font-bold text-zinc-900 dark:text-white">
            {section.category === 'Firmware' ? (
              <Icon name="seti:config" class="text-[#AC121F]" />
            ) : (
              <Icon name="document" class="text-[#AC121F]" />
            )}
            {section.category}
          </h3>

          <div class="space-y-3">
            {section.items.map((item) => (
              <div class="rounded-lg border border-zinc-100 bg-white p-4 shadow-sm transition-all hover:border-[#AC121F]/40 dark:border-zinc-700 dark:bg-zinc-800">
                <div class="flex flex-col justify-between gap-4 sm:flex-row sm:items-center">
                  {/* å·¦ä¾§ä¿¡æ¯ */}
                  <div>
                    <div class="text-base font-bold text-zinc-800 dark:text-zinc-100">
                      {item.title}
                    </div>
                    {item.date && (
                      <div class="mt-1 flex items-center gap-1 text-xs text-zinc-500">
                        {/* ğŸ‘‡ 2. æ›¿æ¢ä¸ºè‡ªå®šä¹‰ç»„ä»¶ */}
                        <CalendarSvg class="shrink-0" />
                        Update: {item.date}
                      </div>
                    )}
                  </div>

                  {/* å³ä¾§æŒ‰é’® */}
                  <a
                    href={item.fileUrl}
                    target="_blank"
                    class="flex min-w-[120px] items-center justify-center gap-2 rounded-lg bg-[#AC121F] px-5 py-2 text-sm font-bold text-white no-underline shadow-sm transition-colors hover:bg-[#c91524]"
                  >
                    <DownSvg />
                    Download
                  </a>
                </div>

                {/* Release Notes æŠ˜å åŒºåŸŸ */}
                {item.releaseNotes && (
                  <div class="mt-3 border-t border-dashed border-zinc-200 pt-3 dark:border-zinc-700">
                    <details class="group/details text-sm">
                      <summary class="flex w-fit cursor-pointer items-center gap-1 font-medium text-zinc-500 transition-colors select-none hover:text-[#AC121F]">
                        <span class="group-open/details:hidden">
                          View Release Notes
                        </span>
                        <span class="hidden group-open/details:inline">
                          Hide Release Notes
                        </span>
                        <DownSvg class="transition-transform group-open/details:rotate-180" />
                      </summary>
                      <div class="mt-2 rounded-r-md border-l-2 border-[#AC121F]/30 bg-zinc-50 p-3 pl-3 leading-7 whitespace-pre-line text-zinc-600 dark:bg-black/20 dark:text-zinc-400">
                        {item.releaseNotes}
                      </div>
                    </details>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      ))
  }
</div>
