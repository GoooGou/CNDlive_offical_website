---
// src/layouts/ProductLayout.astro
import ContentLayout from '@/layouts/ContentLayout.astro';
import ProductTabs from '@/components/products/ProductTabs.astro'; 
// ğŸ”¥ 1. å¼•å…¥ SEO å·¥å…·å‡½æ•° (è®©ä»£ç å˜å¹²å‡€çš„å…³é”®)
import { generateProductSchema } from '@/utils/seo';

interface Props {
  post: any;
  basePath: string;
  parentTitle: string;
  activeTabId: 'overview' | 'tech-specs' | 'download';
}

const { post, basePath, parentTitle, activeTabId } = Astro.props;

// 1. åŠ¨æ€ç”Ÿæˆ URL
const baseUrl = `${basePath}/${post.id}`;

// 2. Tab é€»è¾‘ (ä¿æŒä½ çš„ä¿®å¤ç‰ˆæœ¬ï¼Œé€»è¾‘æ­£ç¡®)
const tabItems = [
  { id: 'overview', label: 'Overview', href: baseUrl },
  { id: 'tech-specs', label: 'Tech Specs', href: `${baseUrl}/specs` }
];

// åªæœ‰å½“æœ‰ä¸‹è½½èµ„æºæ—¶ï¼Œæ‰åŠ¨æ€æ·»åŠ  Download Tab
if (post.data.downloadUrl || post.data.manualPdf || (post.data.downloads && post.data.downloads.length > 0)) {
  tabItems.push({ id: 'download', label: 'Download', href: `${baseUrl}/downloads` });
}

// --- ğŸ”¥ 3. æç®€ç”Ÿæˆ SEO Schema ---
// ä»¥å‰è¿™é‡Œæœ‰å‡ åè¡Œä»£ç ï¼Œç°åœ¨åªéœ€è¦ä¸€è¡Œ
// æ³¨æ„ï¼šå¿…é¡»ä¼ å…¥ Astro.site ä»¥ç”Ÿæˆç»å¯¹è·¯å¾„
// å¦‚æœ Astro.site æ˜¯ç©ºçš„ï¼Œå°±ç”¨åé¢è¿™ä¸ªä¸´æ—¶çš„
const productSchema = generateProductSchema(post, Astro.site || new URL("https://cndlive.com"));---
---
<ContentLayout
  title={post.data.title}
  
  {/* ğŸ”¥ 4. ä¼ é€’æ•°æ®ç»™ ContentLayout */}
  description={post.data.description}
  image={post.data.cover}
  schema={productSchema}

  breadcrumbItems={[
    { label: parentTitle, href: basePath },
    { label: post.data.title }
  ]}
  backHref={basePath}
  backLabel={`Back to ${parentTitle}`}
>

  {/* 2. Tab å¯¼èˆª */}
  <ProductTabs items={tabItems} activeId={activeTabId} />

  {/* é¡µé¢ä¸»ä½“å®¹å™¨ */}
  <div class="max-w-5xl mx-auto w-full relative min-h-[60vh]">
    
    {/* 1. å…¬å…±å¤´éƒ¨ */}
    <header class="mb-8 text-center pt-8">
        <h1 class="text-3xl md:text-5xl font-bold mb-4 text-text-main leading-tight">
            {post.data.title}
        </h1>
        {post.data.description && (
          <p class="text-xl text-text-muted max-w-2xl mx-auto">{post.data.description}</p>
        )}
    </header>

    {/* 3. ä¸åŒçš„é¡µé¢å†…å®¹åœ¨è¿™é‡Œæ¸²æŸ“ (Slot) */}
    <article class="w-full mt-8 animate-in fade-in duration-500">
      <slot />
    </article>

  </div>
</ContentLayout>