---
// src/layouts/ProductLayout.astro
import ContentLayout from '@/layouts/ContentLayout.astro';
import ProductTabs from '@/components/products/ProductTabs.astro'; 

interface Props {
  post: any;
  basePath: string;
  parentTitle: string;
  activeTabId: 'overview' | 'tech-specs' | 'download';
}

const { post, basePath, parentTitle, activeTabId } = Astro.props;

// 1. åŠ¨æ€ç”Ÿæˆ URL
const baseUrl = `${basePath}/${post.id}`;

// 2. åˆå§‹åŒ– Tab (æ³¨æ„ï¼šä¸è¦åœ¨è¿™é‡Œå†™ 'download'ï¼Œå¦åˆ™åé¢åˆ¤æ–­åä¼šé‡å¤)
const tabItems = [
  { id: 'overview', label: 'Overview', href: baseUrl },
  { id: 'tech-specs', label: 'Tech Specs', href: `${baseUrl}/specs` }
];

// 3. åªæœ‰å½“æœ‰ä¸‹è½½èµ„æºæ—¶ï¼Œæ‰æ·»åŠ  Download Tab
// (è¿™é‡Œé€‚é…äº†æˆ‘ä»¬ä¹‹å‰æ”¹è¿‡çš„ downloads æ•°ç»„ç»“æ„)
if (post.data.downloads && post.data.downloads.length > 0) {
  tabItems.push({ id: 'download', label: 'Download', href: `${baseUrl}/downloads` });
}

// --- ğŸ”¥ 4. æ„é€  SEO Schema (æ–°å¢) ---
// Google å¿…é¡»è¦æ±‚å›¾ç‰‡æ˜¯ç»å¯¹è·¯å¾„ (https://...)
const coverImageAbsolute = new URL(post.data.cover, Astro.site).toString();

const productSchema = {
  "@context": "https://schema.org/",
  "@type": "Product",
  "name": post.data.title,
  "image": coverImageAbsolute,
  "description": post.data.description,
  "brand": {
    "@type": "Brand",
    "name": "CNDLive"
  },
  "sku": post.id,
  "offers": {
    "@type": "Offer",
    "url": Astro.url.href,
    "priceCurrency": "USD",
    "availability": "https://schema.org/InStock",
    "price": "0" // Bç«¯äº§å“é€šå¸¸ä¸ç›´æ¥æ˜¾ç¤ºä»·æ ¼ï¼Œæˆ–è€…æ ‡è®°ä¸º "PreOrder"
  }
};
---

<ContentLayout
  title={post.data.title}
  
  {/* ğŸ”¥ 5. ä¼ é€’ SEO æ•°æ®ç»™çˆ¶çº§ Layout */}
  description={post.data.description}
  image={post.data.cover}  {/* ç¤¾äº¤åˆ†äº«å›¾ */}
  schema={productSchema}   {/* è°·æ­Œç»“æ„åŒ–æ•°æ® */}

  breadcrumbItems={[
    { label: parentTitle, href: basePath },
    { label: post.data.title }
  ]}
  backHref={basePath}
  backLabel={`Back to ${parentTitle}`}
>

  {/* å®¹å™¨ï¼šè°ƒæ•´äº†æœ€å¤§å®½åº¦å’Œé—´è· */}
  <div class="max-w-5xl mx-auto w-full relative min-h-[60vh]">
    
    {/* 1. å…¬å…±å¤´éƒ¨ (æ ‡é¢˜) */}
    {/* é¢œè‰²ä¿®æ”¹ï¼štext-white -> text-text-main ä»¥é€‚é…é»‘ç™½ä¸»é¢˜ */}
    <header class="mb-8 text-center pt-8">
        <h1 class="text-3xl md:text-5xl font-bold mb-4 text-text-main leading-tight">
            {post.data.title}
        </h1>
        {post.data.description && (
          <p class="text-xl text-text-muted max-w-2xl mx-auto">{post.data.description}</p>
        )}
    </header>

    {/* 2. Tab å¯¼èˆª */}
    {/* å»ºè®®æ”¾åœ¨ Header ä¸‹æ–¹ï¼Œå†…å®¹ä¸Šæ–¹ */}
    <ProductTabs items={tabItems} activeId={activeTabId} />

    {/* 3. é¡µé¢å…·ä½“å†…å®¹æ’æ§½ */}
    <article class="w-full mt-8 animate-in fade-in duration-500">
      <slot />
    </article>

  </div>
</ContentLayout>