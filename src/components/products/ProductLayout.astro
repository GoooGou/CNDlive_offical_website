---
// src/layouts/ProductLayout.astro
import ContentLayout from '@/layouts/ContentLayout.astro';
import ProductTabs from '@/components/products/ProductTabs.astro';
import { generateProductSchema } from '@/utils/seo';

interface Props {
  post: any;
  basePath: string;
  parentTitle: string;
  activeTabId: 'overview' | 'tech-specs' | 'download';
}

const { post, basePath, parentTitle, activeTabId } = Astro.props;

// 1. 动态生成 URL
const baseUrl = `${basePath}/${post.id}`;

// 2. Tab 逻辑
const tabItems = [
  { id: 'overview', label: 'Overview', href: baseUrl },
  { id: 'tech-specs', label: 'Tech Specs', href: `${baseUrl}/specs` },
];

// 动态添加 Download Tab
if (
  post.data.downloadUrl ||
  post.data.manualPdf ||
  (post.data.downloads && post.data.downloads.length > 0)
) {
  tabItems.push({
    id: 'download',
    label: 'Download',
    href: `${baseUrl}/downloads`,
  });
}

// 3. SEO Schema
const productSchema = generateProductSchema(
  post,
  Astro.site || new URL('https://cndlive.com')
);
---

<ContentLayout
  title={post.data.title}
  description={post.data.description}
  image={post.data.cover}
  schema={productSchema}
  breadcrumbItems={[
    { label: parentTitle, href: basePath },
    { label: post.data.title },
  ]}
  backHref={basePath}
  backLabel={`Back to ${parentTitle}`}
>
  {/* 2. Tab 导航 (已适配深色/亮色) */}
  <ProductTabs items={tabItems} activeId={activeTabId} />

  {/* 页面主体容器 */}
  <div class="relative mx-auto min-h-[60vh] w-full max-w-5xl">
    {/* 1. 公共头部 */}
    <header class="mb-8 pt-8 text-center">
      <h1
        class="text-text-main mb-4 text-3xl leading-tight font-bold transition-colors duration-300 md:text-5xl"
      >
        {post.data.title}
      </h1>
      {
        post.data.description && (
          <p class="text-text-muted mx-auto max-w-2xl text-xl transition-colors duration-300">
            {post.data.description}
          </p>
        )
      }
    </header>

    {/* 3. 不同的页面内容在这里渲染 (Slot) */}
    {
      /* 这里通常是 MDX 内容，会自动应用全局 prose 样式 (prose dark:prose-invert) */
    }
    <article class="animate-in fade-in mt-8 w-full duration-500">
      <slot />
    </article>
  </div>
</ContentLayout>
