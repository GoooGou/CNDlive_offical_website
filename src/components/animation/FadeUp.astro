---
interface Props {
  /** å®¹å™¨ç±»å (é€šå¸¸ç”¨äº grid æˆ– flex å¸ƒå±€) */
  class?: string;
  /** æ¯ä¸ªå­å…ƒç´ ä¹‹é—´çš„é—´éš”æ—¶é—´ (ç§’)ï¼Œé»˜è®¤ 0.1 */
  stagger?: number;
  /** ä¸Šæµ®è·ç¦» (px)ï¼Œé»˜è®¤ 30 */
  y?: number;
  /** åŠ¨ç”»æ—¶é•¿ (ç§’)ï¼Œé»˜è®¤ 0.6 */
  duration?: number;
}

const {
  class: className = '',
  stagger = 0.1,
  y = 30,
  duration = 0.6,
} = Astro.props;
---

<div
  class:list={['stagger-fade-trigger', className]}
  data-stagger={stagger}
  data-y={y}
  data-duration={duration}
>
  <slot />
</div>

<script>
  import { gsap } from 'gsap';

  const initStaggerFade = () => {
    const containers = document.querySelectorAll('.stagger-fade-trigger');
    if (containers.length === 0) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const container = entry.target as HTMLElement;
            // âœ… è½¬æ¢ä¸ºæ•°ç»„ï¼Œç¡®ä¿å…¼å®¹æ€§
            const children = Array.from(container.children);

            if (children.length === 0) return;

            // è¯»å–é…ç½®
            const staggerTime = Number(container.dataset.stagger || 0.1);
            const duration = Number(container.dataset.duration || 0.6);

            // ğŸ”¥ æ ¸å¿ƒï¼šä¾æ¬¡æ’­æ”¾åŠ¨ç”»
            gsap.to(children, {
              opacity: 1,
              y: 0,
              duration: duration,
              ease: 'power2.out',
              // âœ…è¿™å°±æ˜¯â€œä¾æ¬¡å‡ºç°â€çš„å…³é”®ï¼šæ¯ä¸ªå…ƒç´ é—´éš” staggerTime ç§’
              stagger: staggerTime,
              overwrite: 'auto',
            });

            observer.unobserve(container);
          }
        });
      },
      { threshold: 0.1 }
    );

    containers.forEach((el) => {
      const c = el as HTMLElement;
      const yDist = Number(c.dataset.y || 30);
      const children = Array.from(c.children);

      // âœ… åˆå§‹åŒ–ï¼šå…¨éƒ¨éšè—
      if (children.length > 0) {
        gsap.set(children, {
          opacity: 0,
          y: yDist,
        });
        observer.observe(c);
      }
    });
  };

  document.addEventListener('astro:page-load', initStaggerFade);
  document.addEventListener('DOMContentLoaded', initStaggerFade);
</script>
