---
import { render } from 'astro:content';
import ContentLayout from '@/layouts/ContentLayout.astro';
import Cover from '@/components/common/Cover.astro';
import TableOfContents from '@/components/mdx/TableOfContents.astro';
import ArticleBody from '../mdx/ArticleBody.astro';

interface Props {
  post: any;
  basePath: string;
  parentTitle: string;
  schema?: object; // 1. ç±»å‹å®šä¹‰
}

// ğŸ”¥ 2. å…³é”®ä¿®æ”¹ï¼šå¿…é¡»åœ¨è¿™é‡ŒæŠŠ schema è§£æ„å‡ºæ¥ï¼Œå¦åˆ™ä¸‹é¢æ‹¿ä¸åˆ°ï¼
const { post, basePath, parentTitle, schema } = Astro.props;

const { headings } = await render(post);
---

<ContentLayout
  title={post.data.title}
  
  {/* ğŸ”¥ 3. SEO æ ¸å¿ƒï¼šæŠŠæ•°æ®ä¼ ç»™ Layout æ¸²æŸ“åˆ° <head> */}
  description={post.data.description}
  image={post.data.cover}
  schema={schema}

  breadcrumbItems={[
    { label: parentTitle, href: basePath },
    { label: post.data.title }
  ]}
  backHref={basePath}
  backLabel={`Back to ${parentTitle}`}
>

  <div class="grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-12 lg:gap-16 items-start relative">
    
    {/* === å·¦ä¾§ï¼šæ–‡ç« ä¸»ä½“ === */}
    <article class="min-w-0 max-w-none w-full">
      
      {/* å¤´éƒ¨ä¿¡æ¯ */}
      <header class="mb-10 text-center lg:text-left">
        {/* é€‚é…ä¸»é¢˜ï¼štext-white -> text-text-main */}
        <h1 class="text-3xl md:text-5xl font-bold mb-6 text-text-main leading-tight">
          {post.data.title}
        </h1>
        <p class="text-text-muted">
          By {post.data.author || 'CNDLive Team'} â€¢ {new Date(post.data.pubDate).toLocaleDateString()}
        </p>
      </header>

      {/* å°é¢å›¾ */}
      {/* é€‚é…ä¸»é¢˜ï¼šborder-zinc-800 -> border-surface-border */}
      <div class="rounded-2xl overflow-hidden mb-12 aspect-video border border-surface-border shadow-2xl relative">
        <Cover src={post.data.cover} alt={post.data.title} title={post.data.title} />
      </div>

      {/* æ­£æ–‡å†…å®¹ */}
      <ArticleBody post={post} />
    </article>

    {/* === å³ä¾§ï¼šç²˜æ€§ç›®å½• (ä»…åœ¨ç”µè„‘ç«¯æ˜¾ç¤º) === */}
    <aside class="hidden lg:block sticky top-24 h-fit">
      {headings.length > 0 && (
        <TableOfContents headings={headings} />
      )}
    </aside>

  </div>

</ContentLayout>