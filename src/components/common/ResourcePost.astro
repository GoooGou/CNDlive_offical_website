---
// ğŸ”¥ 1. å¿…é¡»å¼•å…¥ render å‡½æ•°
import { render } from 'astro:content';
import ContentLayout from '@/layouts/ContentLayout.astro';
import Cover from '@/components/common/Cover.astro';
import MDXContent from '@/components/mdx/MDXContent.astro';
import TableOfContents from '@/components/mdx/TableOfContents.astro'; // âœ… å¼•å…¥ç›®å½•ç»„ä»¶

interface Props {
  post: any;
  basePath: string;
  parentTitle: string;
}

const { post, basePath, parentTitle } = Astro.props;
// ğŸ”¥ è·å–æ‰€æœ‰æ ‡é¢˜æ•°æ® (Astro æ¸²æŸ“æ—¶è‡ªå¸¦çš„åŠŸèƒ½)

// âœ… æ­£ç¡®å†™æ³• (Astro 5.0 æ ‡å‡†å†™æ³•)
const { headings } = await render(post);
---

<ContentLayout
  title={post.data.title}
  breadcrumbItems={[
    { label: parentTitle, href: basePath },
    { label: post.data.title }
  ]}
  backHref={basePath}
  backLabel={`Back to ${parentTitle}`}
>

  {/* ğŸ”¥ å¸ƒå±€æ”¹é€ æ ¸å¿ƒï¼š
      1. ä½¿ç”¨ Grid å¸ƒå±€ã€‚
      2. lg:grid-cols-[1fr_280px] è¡¨ç¤ºï¼šå¤§å±ä¸‹ï¼Œå·¦è¾¹å æ»¡å‰©ä½™ç©ºé—´ï¼Œå³è¾¹å›ºå®š 280px æ”¾ç›®å½•ã€‚
      3. gap-16 æ‹‰å¼€é—´è·ã€‚
  */}
  <div class="grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-12 lg:gap-16 items-start relative">
    
    {/* === å·¦ä¾§ï¼šæ–‡ç« ä¸»ä½“ === */}
    {/* min-w-0 æ˜¯é˜²æ­¢ grid å­å…ƒç´ æº¢å‡ºçš„å…³é”® */}
    <article class="min-w-0 max-w-none w-full">
      
      {/* å¤´éƒ¨ä¿¡æ¯ */}
      <header class="mb-10 text-center lg:text-left">
        <h1 class="text-3xl md:text-5xl font-bold mb-6 text-white leading-tight">{post.data.title}</h1>
        <p class="text-zinc-500">By {post.data.author} â€¢ {post.data.pubDate.toLocaleDateString()}</p>
      </header>

      {/* å°é¢å›¾ */}
      <div class="rounded-2xl overflow-hidden mb-12 aspect-video border border-zinc-800 shadow-2xl">
        <Cover src={post.data.cover} alt={post.data.title} title={post.data.title} />
      </div>

      {/* æ­£æ–‡æ¸²æŸ“ */}
      <div class="prose prose-invert prose-lg max-w-none 
        prose-headings:text-white 
        prose-headings:scroll-mt-24 /* ğŸ”¥ å…³é”®ï¼šç‚¹å‡»é”šç‚¹æ—¶ï¼Œä¸ä¼šè¢«é¡¶éƒ¨å¯¼èˆªæ æŒ¡ä½ */
        prose-p:text-zinc-300 
        prose-img:rounded-xl">
        
        <MDXContent post={post} />
        
      </div>
    </article>

    {/* === å³ä¾§ï¼šç²˜æ€§ç›®å½• (ä»…åœ¨ç”µè„‘ç«¯æ˜¾ç¤º) === */}
    <aside class="hidden lg:block sticky top-24 h-fit">
      {/* åªæœ‰å½“æœ‰æ ‡é¢˜æ—¶æ‰æ˜¾ç¤ºç›®å½• */}
      {headings.length > 0 && (
        <TableOfContents headings={headings} />
      )}
    </aside>

  </div>

</ContentLayout>