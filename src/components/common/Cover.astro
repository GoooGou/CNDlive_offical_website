---
import IMG from './IMG.astro';

interface Props {
  src?: any;
  alt: string;
  title?: string;
  className?: string;
  raw?: boolean;
  variant?: 'hero' | 'list';
  loading?: 'eager' | 'lazy';
}

const {
  src,
  alt,
  title = 'CNDLive',
  className = '',
  raw = false,
  variant = 'list',
  loading = variant === 'hero' ? 'eager' : 'lazy',
} = Astro.props;

// --- 1. ç®€å•çš„å“ˆå¸Œå‡½æ•° ---
const getHashIndex = (str: string) => {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = str.charCodeAt(i) + ((hash << 5) - hash);
  }
  return Math.abs(hash);
};

// --- 2. å®šä¹‰ä¸°å¯Œçš„æ¸å˜è‰²æ¿ (6ç§é£æ ¼) ---
const gradients = [
  // 2. ğŸ”µ æ·±é‚ƒç§‘æŠ€è“ (ä¸“ä¸š/ç¨³é‡)
  // é€‚åˆ: æŠ€æœ¯æ–‡æ¡£ã€ç¡¬æ ¸å†…å®¹
  'bg-gradient-to-br from-slate-900 via-blue-900 to-cyan-900',

  // 4. ğŸŸ¢ æ·±æµ·æå…‰ç»¿ (æ¸…æ–°/ç”Ÿé•¿)
  // é€‚åˆ: æ•™ç¨‹ã€å…¥é—¨æŒ‡å—
  'bg-gradient-to-br from-emerald-600 via-teal-700 to-slate-800',

  // 5. ğŸŒ‘ é«˜çº§æš—é»‘ç° (æç®€/é«˜ç«¯)
  // é€‚åˆ: ç¡¬ä»¶å‚æ•°ã€é€šç”¨å†…å®¹
  'bg-gradient-to-br from-zinc-600 via-zinc-800 to-black',

  // 6. ğŸŒ… è½æ—¥ç†”é‡‘ (æ¸©æš–/é†’ç›®)
  // é€‚åˆ: ç¤¾åŒºåŠ¨æ€ã€å…¬å‘Š
  'bg-gradient-to-br from-rose-500 via-pink-600 to-orange-600',
];

// æ ¹æ®æ ‡é¢˜å“ˆå¸Œå€¼ï¼Œåœ¨ gradients æ•°ç»„é•¿åº¦èŒƒå›´å†…å–ä½™
const themeClass = gradients[getHashIndex(title) % gradients.length];
const hasImage = !!src;

// --- 3. æ ·å¼é…ç½® ---
const variantStyles = {
  hero: {
    wrapper: 'p-8 md:p-12',
    text: 'text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black leading-tight tracking-wide drop-shadow-xl',
    clamp: '',
  },
  list: {
    wrapper: 'p-4',
    text: 'text-lg md:text-xl font-bold leading-snug tracking-tight text-shadow-md',
    clamp: 'line-clamp-3',
  },
};

const currentStyle = variantStyles[variant];
---

<div
  class={`
  relative w-full h-full overflow-hidden 
  bg-zinc-100 dark:bg-zinc-900
  ${className}
`}
>
  {
    hasImage ? (
      /* --- æƒ…å†µ A: æœ‰å›¾ç‰‡ --- */
      <IMG
        src={src}
        alt={alt}
        title={title}
        raw={raw}
        loading={loading}
        class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
      />
    ) : (
      /* --- æƒ…å†µ B: æ— å›¾ç‰‡ï¼Œä½¿ç”¨éšæœºæ¸å˜èƒŒæ™¯ --- */
      <div
        class={`flex h-full w-full flex-col items-center justify-center text-center transition-transform duration-700 group-hover:scale-105 ${currentStyle.wrapper} ${themeClass} /* ğŸ‘ˆ åº”ç”¨éšæœºèƒŒæ™¯ */`}
      >
        <div class="relative z-10 mx-auto w-full max-w-4xl">
          <h3
            class={`wrap-break-word hyphens-auto text-white ${currentStyle.text} ${currentStyle.clamp}`}
          >
            {title}
          </h3>
        </div>
      </div>
    )
  }

  {/* âœ¨ ç»Ÿä¸€å†…è¾¹æ¡† (Overlay Ring) */}
  <div
    class="pointer-events-none absolute inset-0 rounded-[inherit] ring-1 ring-black/5 ring-inset dark:ring-white/10"
  >
  </div>
</div>
