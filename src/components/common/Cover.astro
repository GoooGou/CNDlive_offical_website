---
import IMG from './IMG.astro';

interface Props {
  src?: any;
  alt: string;
  title?: string;
  className?: string;
  raw?: boolean;
  variant?: 'hero' | 'list';
  loading?: 'eager' | 'lazy';
}

const {
  src,
  alt,
  title = 'CNDLive',
  className = '',
  raw = false,
  variant = 'list',
  loading = variant === 'hero' ? 'eager' : 'lazy',
} = Astro.props;

// --- 1. ç®€å•çš„å“ˆå¸Œå‡½æ•° ---
// å°†æ ‡é¢˜å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼Œç¡®ä¿åŒä¸€æ ‡é¢˜æ°¸è¿œå¯¹åº”åŒä¸€ç§é¢œè‰²
const getHashIndex = (str: string) => {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = str.charCodeAt(i) + ((hash << 5) - hash);
  }
  return Math.abs(hash);
};

// --- 2. å®šä¹‰ä¸¤å¥—ç‰¹å®šèƒŒæ™¯ ---
const gradients = [
  // ğŸ”´ğŸŸ  æ–¹æ¡ˆä¸€ï¼šçº¢æ©™æš–è‰² (Red-Orange)
  // å……æ»¡æ´»åŠ›ï¼Œä»äº®æ©™è¿‡æ¸¡åˆ°æ·±çº¢
  'bg-gradient-to-br from-orange-400 via-red-500 to-red-700',

  // âš«ï¸ğŸ”µğŸŸ¢ æ–¹æ¡ˆäºŒï¼šé»‘è“é’å†·è‰² (Black-Blue-Cyan)
  // ç§‘æŠ€æ„Ÿæ·±è‰²ï¼Œä»æ¥è¿‘é»‘è‰²çš„æ·±è“è¿‡æ¸¡åˆ°é’è‰²
  'bg-gradient-to-br from-slate-900 via-blue-900 to-cyan-800',
];

// æ ¹æ®æ ‡é¢˜å“ˆå¸Œå€¼ï¼Œåœ¨ 0 å’Œ 1 ä¹‹é—´é€‰æ‹©
const themeClass = gradients[getHashIndex(title) % gradients.length];
const hasImage = !!src;

// --- 3. æ ·å¼é…ç½® (Hero vs List) ---
const variantStyles = {
  hero: {
    wrapper: 'p-8 md:p-12',
    text: 'text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black leading-tight tracking-wide drop-shadow-xl',
    clamp: '',
  },
  list: {
    wrapper: 'p-4',
    text: 'text-lg md:text-xl font-bold leading-snug tracking-tight text-shadow-md',
    clamp: 'line-clamp-3',
  },
};

const currentStyle = variantStyles[variant];
---

<div
  class={`
  relative w-full h-full overflow-hidden 
  bg-zinc-100 dark:bg-zinc-900
  ${className}
`}
>
  {
    hasImage ? (
      /* --- æƒ…å†µ A: æœ‰å›¾ç‰‡ --- */
      <IMG
        src={src}
        alt={alt}
        title={title}
        raw={raw}
        loading={loading}
        class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
      />
    ) : (
      /* --- æƒ…å†µ B: æ— å›¾ç‰‡ï¼Œä½¿ç”¨è®¡ç®—å‡ºçš„æ¸å˜èƒŒæ™¯ --- */
      <div
        class={`flex h-full w-full flex-col items-center justify-center text-center transition-transform duration-700 group-hover:scale-105 ${currentStyle.wrapper} ${themeClass} /* ğŸ‘ˆ åº”ç”¨éšæœºé€‰ä¸­çš„èƒŒæ™¯ */`}
      >
        <div class="relative z-10 mx-auto w-full max-w-4xl">
          <h3
            class={`wrap-break-word hyphens-auto text-white ${currentStyle.text} ${currentStyle.clamp}`}
          >
            {title}
          </h3>
        </div>
      </div>
    )
  }

  {/* âœ¨ ç»Ÿä¸€å†…è¾¹æ¡† (Overlay Ring) */}
  <div
    class="pointer-events-none absolute inset-0 rounded-[inherit] ring-1 ring-black/5 ring-inset dark:ring-white/10"
  >
  </div>
</div>
