---
// src/components/ProgressBar.astro
---

<script>
  import NProgress from 'nprogress';
  // 引入默认样式，或者你可以稍后自定义
  import 'nprogress/nprogress.css';

  // 配置 NProgress (关闭右侧那个旋转的 spinner，通常只需要顶部的条)
  NProgress.configure({ showSpinner: false });

  // 1. 当路由开始准备跳转时（用户点击链接后），开始进度条
  document.addEventListener('astro:before-preparation', () => {
    NProgress.start();
  });

  // 2. 当页面加载完成时，结束进度条
  document.addEventListener('astro:page-load', () => {
    NProgress.done();
  });

  // 3. (可选) 如果跳转被取消或发生错误，也应该结束
  document.addEventListener('astro:after-preparation', () => {
    // 这里通常不需要做太多，因为 page-load 会触发，
    // 但为了保险起见，可以在出错时重置，视具体需求而定。
  });
</script>

<style is:global>
  /* 自定义进度条颜色 - 配合你之前的红色主题 */
  #nprogress .bar {
    background: #ac121f !important; /* Tailwind 的 red-500 */
    height: 6px !important; /* 进度条高度 */
    z-index: 99999;
  }
  /* 2. 自定义“进度头的小光” (Peg) */
  #nprogress .peg {
    /* box-shadow 是关键：
       前两个参数是偏移量，
       第三个参数是模糊半径（控制光的扩散程度）。
       
       建议：把光设为跟进度条一样的颜色，或者稍微亮一点的颜色。
    */
    box-shadow:
      0 0 10px #e42b3a,
      0 0 5px #e42b3a !important;

    /* 如果你想让光更强，可以增加阴影范围，例如：
       box-shadow: 0 0 15px #ac121f, 0 0 10px #ff0000 !important; 
    */
  }
</style>
