---
// src/components/navbar/NavLogo.astro
---

<a href="/" class="block">
  <div id="nav-logo-container" class="h-20 w-32 md:w-40"></div>
</a>

<script>
  import lottie from 'lottie-web';

  // 用于存储动画实例，方便销毁
  let animationInstance: any = null;

  const initLogo = () => {
    const container = document.getElementById('nav-logo-container');

    if (container) {
      // 1. 更稳健的清理方式：如果有旧动画实例，先销毁它
      // 这比 innerHTML = '' 更安全，能停止后台的计时器和未完成的请求
      if (animationInstance) {
        animationInstance.destroy();
      }

      // 保险起见，再清空一次 DOM
      container.innerHTML = '';

      // 2. 加载新动画并赋值给实例变量
      animationInstance = lottie.loadAnimation({
        container: container,
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: '/logo.json',
      });
    }
  };

  // 3. 只使用 astro:page-load
  // 它涵盖了“首次加载”和“页面切换”两种情况，所以下面不需要再写 initLogo() 了
  document.addEventListener('astro:page-load', initLogo);
</script>
