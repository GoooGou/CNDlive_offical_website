---
// src/components/mdx/PostImage.astro
import IMG from '@/components/common/IMG.astro';

interface Props {
  src: any;
  alt: string;
  title?: string; // 主要用于 Caption，也可以作为 title 属性透传
  raw?: boolean; // 1. 透传控制属性：true = 强制使用原生 img
}

const { src, alt, title, raw = false } = Astro.props;
---

<figure class="my-8">
  <div
    class:list={[
      'border-surface-border relative overflow-hidden rounded-xl border shadow-2xl',
      // ✅ 新增：添加基础背景色。
      // 因为 IMG 组件现在有 fade-in 动画，设置背景色可以避免图片加载前出现"空窗期"或透明穿透
      'bg-zinc-100 dark:bg-zinc-800',
    ]}
  >
    {
      /* ✨ 纯净版 IMG 调用：
      只负责渲染图片 + 淡入动画。
      宽高样式 (h-auto w-full) 由这里传入控制。
    */
    }
    <IMG
      src={src}
      alt={alt}
      title={title}
      raw={raw}
      class="h-auto w-full object-cover"
    />
  </div>

  {/* Caption 部分：显示 title 或 alt */}
  {
    (title || alt) && (
      <figcaption class="mt-2 text-center font-mono text-xs text-zinc-500">
        {title || alt}
      </figcaption>
    )
  }
</figure>
