---
// src/components/mdx/PostImage.astro
import IMG from '@/components/common/IMG.astro';

interface Props {
  src: any; // 类型由 IMG 内部处理
  alt: string;
  title?: string; // 既用于 Caption，也传给 IMG 生成兜底背景种子
  raw?: boolean; // 1. 透传控制属性：true = 强制使用原生 img
}

const { src, alt, title, raw = false } = Astro.props;
---

<figure class="my-8">
  <div
    class="border-surface-border relative overflow-hidden rounded-xl border shadow-2xl"
  >
    {
      /* ✨ 核心修改：
      直接调用 IMG 组件。
      - 自动处理 src 是字符串还是对象
      - 自动处理 raw 参数决定是用 <img> 还是 <Image />
      - 自动处理无图时的渐变兜底
    */
    }
    <IMG
      src={src}
      alt={alt}
      title={title}
      raw={raw}
      class="h-auto w-full object-cover"
    />
  </div>

  {/* Caption 部分保持不变，依旧负责显示图片下方的文字 */}
  {
    (title || alt) && (
      <figcaption class="mt-2 text-center font-mono text-xs text-zinc-500">
        {title || alt}
      </figcaption>
    )
  }
</figure>
