---
// src/components/mdx/CodeBlock.astro
// è¿™ä¸ªç»„ä»¶è¦†ç›–äº† MDX æ¸²æŸ“å™¨è¾“å‡ºçš„ <pre> æ ‡ç­¾

// ä» <pre class="language-js"> ä¸­æ¥æ”¶å±æ€§
const { class: languageClass, ...rest } = Astro.props;

// æå–è¯­è¨€æ ‡ç­¾ï¼Œä¾‹å¦‚ä» "language-ts" å¾—åˆ° "TS"
const lang = languageClass?.replace('language-', '').toUpperCase() || 'CODE';
---

<div class="code-wrapper relative my-8 rounded-xl shadow-lg">
  {/* é¡¶éƒ¨è¯­è¨€æ ‡ç­¾ - Tailwind Styling */}
  <div
    class="absolute top-0 right-0 rounded-tr-xl rounded-bl-lg bg-[var(--code-border)] px-2 py-1 font-mono text-xs text-zinc-300 select-none dark:bg-[var(--code-border-dark)]"
  >
    {lang}
  </div>

  {/* æ¸²æŸ“ä»£ç åŒºåŸŸ (Slot åŒ…å« Expressive Code/Shiki ç”Ÿæˆçš„ <code> ç»“æ„) */}
  <pre
    class={`
      // --- å¸ƒå±€å’Œå­—ä½“ ---
      !m-0 p-5 overflow-x-auto rounded-xl text-sm font-mono 
      
      // è¿™é‡Œçš„é¢œè‰²ä¼šè¢« style å—é‡Œçš„å˜é‡è¦†ç›–ï¼Œä½†æˆ‘ä»¬ä»éœ€ä¿æŒç»“æ„å®Œæ•´
      ${languageClass} 
    `}
    {...rest}><slot /></pre>
</div>

{/* ---------------------------------------------------- */}
{
  /* ğŸ”¥ æ ¸å¿ƒä¿®å¤ï¼šé€šè¿‡ CSS å˜é‡ï¼Œç¡®ä¿äº®æš—æ¨¡å¼çš„èƒŒæ™¯å’Œè¾¹æ¡†åˆ‡æ¢ï¼Œå¹¶è§£å†³ prose å†²çª */
}
<style>
  /* 1. å®šä¹‰ Light/Dark æ¨¡å¼ä¸‹çš„é¢œè‰²å˜é‡ */
  .code-wrapper {
    /* Light Mode Default */
    --code-bg: #ffffff;
    --code-border: #e4e4e7;
    --code-text: #1f2937;
  }

  html.dark .code-wrapper {
    /* Dark Mode Override */
    --code-bg: #1a1a20; /* ç»Ÿä¸€çš„æ·±è‰²èƒŒæ™¯ */
    --code-border: #3f3f46;
    --code-text: #f3f4f6;
  }

  /* 2. åº”ç”¨å˜é‡åˆ° <pre> æ ‡ç­¾ (é«˜ä¼˜å…ˆçº§è¦†ç›–) */
  /* ä½¿ç”¨ ::slotted(pre) ç¡®ä¿å³ä½¿ MDX æ›´æ”¹äº† DOM ç»“æ„ï¼Œæ ·å¼ä¹Ÿèƒ½ç©¿é€åº”ç”¨ */
  .code-wrapper pre {
    /* å¼ºåˆ¶åº”ç”¨èƒŒæ™¯/æ–‡å­—é¢œè‰² */
    background-color: var(--code-bg) !important;
    color: var(--code-text) !important;
    border: 1px solid var(--code-border);
    border-radius: 0.75rem !important; /* ä¿æŒåœ†è§’ */

    /* ç¡®ä¿ä»£ç å—å†…çš„æ–‡å­—é¢œè‰²æ˜¯äº®çš„ */
    /* è¿™ä¸€æ­¥éå¸¸å…³é”®ï¼Œå› ä¸ºå®ƒä¼šè¦†ç›– Expressive Code æ³¨å…¥çš„è¡Œå†…é¢œè‰² */
    /* å®é™…ä¸Šï¼ŒExpressive Code/Shiki åº”è¯¥è´Ÿè´£è¿™é‡Œçš„é¢œè‰²ï¼Œä½†ä¸ºäº†è°ƒè¯•ï¼Œæˆ‘ä»¬å…ˆå¼ºåˆ¶ */
  }
</style>
