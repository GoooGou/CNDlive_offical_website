---
// src/pages/products/[id]/downloads.astro
import { getCollection } from 'astro:content';
import ProductLayout from '@/components/products/ProductLayout.astro';
import { marked } from 'marked'; 
import { FileText, Download, Plus, Minus } from 'lucide-react';

export async function getStaticPaths() {
  const posts = await getCollection('products');
  return posts
    .filter(post => post.data.downloads && post.data.downloads.length > 0)
    .map(post => ({
      params: { id: post.id },
      props: { post },
    }));
}

const { post } = Astro.props;
const basePath = '/products';
const downloadSections = post.data.downloads || [];
---

<ProductLayout 
  post={post} 
  basePath={basePath} 
  parentTitle="Products" 
  activeTabId="download"
>
  
  <div class="max-w-4xl mx-auto py-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
    <h2 class="text-3xl font-bold text-white mb-10 text-center">Downloads Center</h2>

    <div class="space-y-8">
      {downloadSections.map((section) => (
        
        /* ğŸ”¥ ç¬¬ä¸€å±‚æŠ˜å ï¼šåˆ†ç±» (Category) */
        /* open å±æ€§é»˜è®¤å±•å¼€åˆ†ç±»ï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´æ¥çœ‹åˆ°å†…å®¹ */
        <details class="group/category" open>
          
          {/* åˆ†ç±»æ ‡é¢˜ç‚¹å‡»åŒº */}
          <summary class="bg-zinc-800 border-l-4 border-primary px-4 py-3 rounded-r-lg cursor-pointer flex items-center justify-between list-none select-none hover:bg-zinc-700 transition">
             <h3 class="text-xl font-bold text-white">{section.category}</h3>
             
             {/* åˆ†ç±»æŠ˜å å›¾æ ‡ */}
             <div class="text-white">
               <Plus className="w-5 h-5 block group-open/category:hidden" />
               <Minus className="w-5 h-5 hidden group-open/category:block" />
             </div>
          </summary>

          {/* åˆ†ç±»ä¸‹çš„å†…å®¹å®¹å™¨ */}
          <div class="mt-4 space-y-4 pl-2 md:pl-4">
            {section.items.map((item) => (
              
              /* ğŸ”¥ ç¬¬äºŒå±‚æŠ˜å ï¼šå…·ä½“æ¡ç›® (Item) */
              <details class="group/item bg-zinc-900/30 border border-white/5 rounded-lg open:bg-zinc-900/50 transition-colors duration-300">
                
                {/* æ¡ç›®ç‚¹å‡»åŒº */}
                <summary class="flex items-center justify-between p-4 cursor-pointer list-none select-none hover:bg-white/5 transition rounded-lg">
                  <span class="text-lg font-medium text-zinc-200 group-hover/item:text-white">
                    {item.title}
                  </span>
                  
                  {/* æ¡ç›®æŠ˜å å›¾æ ‡ */}
                  <div class="text-zinc-500 group-hover/item:text-white transition">
                    <Plus className="w-5 h-5 block group-open/item:hidden" />
                    <Minus className="w-5 h-5 hidden group-open/item:block" />
                  </div>
                </summary>

                {/* å±•å¼€åçš„è¯¦ç»†å†…å®¹ (Release Notes, Download Button) */}
                <div class="px-6 pb-6 pt-2 text-zinc-400 border-t border-white/5">
                  
                  {item.date && (
                    <p class="text-sm text-zinc-500 mb-4">{item.date}</p>
                  )}

                  {item.releaseNotes && (
                    <div class="mb-6">
                       <p class="text-sm font-semibold text-zinc-400 mb-2">Release Notes:</p>
                       <div 
                         class="prose prose-invert prose-sm text-zinc-400 max-w-none
                                prose-ul:list-decimal prose-li:marker:text-zinc-500"
                         set:html={marked.parse(item.releaseNotes)}
                       />
                    </div>
                  )}

                  <div class="mt-4">
                     <a 
                       href={item.fileUrl} 
                       target="_blank"
                       class="inline-flex items-center group/btn"
                     >
                       <div class="w-12 h-12 rounded-full bg-zinc-700 flex items-center justify-center group-hover/btn:bg-primary transition-colors duration-300 shadow-lg">
                          {section.category.includes('Document') ? (
                            <FileText className="w-6 h-6 text-white" />
                          ) : (
                            <Download className="w-6 h-6 text-white" />
                          )}
                       </div>
                       <span class="ml-4 text-sm font-bold text-white border-b border-transparent group-hover/btn:border-primary transition-all">
                         Download
                       </span>
                     </a>
                  </div>

                </div>
              </details>
            ))}
          </div>
        </details>
      ))}
    </div>
  </div>

</ProductLayout>

<style>
  /* éšè—é»˜è®¤çš„å°ä¸‰è§’å½¢ */
  details > summary {
    list-style: none;
  }
  details > summary::-webkit-details-marker {
    display: none;
  }
</style>