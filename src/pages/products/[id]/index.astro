---
// src/pages/products/[id]/index.astro
import { getCollection } from 'astro:content';

// ✅ 修正 1：路径通常是 layouts，除非你真的把它放在 components 里了
import ProductLayout from '@/components/products/ProductLayout.astro'; 

import Cover from '@/components/common/Cover.astro';
import MDXContent from '@/components/mdx/MDXContent.astro';

// ❌ 删除：不需要在这里引入 ProductTabs，因为 ProductLayout 内部已经包含了
// import ProductTabs from '@/components/products/ProductTabs.astro';

// 生成所有产品的路径
export async function getStaticPaths() {
  const posts = await getCollection('products');
  return posts.map(post => ({
    params: { id: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const basePath = '/products'; 
---

<ProductLayout 
  post={post} 
  basePath={basePath} 
  parentTitle="Products" 
  activeTabId="overview"
>
  
  {/* 1. 封面图区域 */}
  {/* ✅ 修正 2：使用语义化变量 bg-surface-card 适配黑白主题 */}
  <div class="rounded-2xl overflow-hidden mb-10 border border-surface-border bg-surface-card shadow-2xl">
    <Cover src={post.data.cover} alt={post.data.title} title={post.data.title} />
  </div>

  {/* 2. 咨询按钮 */}
  <div class="flex justify-center mb-16">
      <a 
        href="/contact" 
        class="bg-primary text-white px-8 py-3 rounded-full font-bold text-lg hover:bg-primary-dark transition-all transform hover:-translate-y-1 shadow-lg shadow-primary/20"
      >
        Enquire Now
      </a>
  </div>

  {/* 3. 产品营销文案 (MDX) */}
  {/* ✅ 修正 3：添加 prose 类，否则 Markdown 内容没有排版样式 */}
  <div class="prose prose-lg max-w-none mx-auto
    /* 基础文字颜色 */
    prose-body:text-text-muted
    prose-headings:text-text-main
    /* 强调文字 */
    prose-strong:text-text-main
    /* 链接颜色 */
    prose-a:text-primary hover:prose-a:text-primary-dark
    /* 列表符号 */
    prose-li:text-text-muted
    /* 图片样式 */
    prose-img:rounded-xl prose-img:shadow-lg
  ">
    <MDXContent post={post} />
  </div>

</ProductLayout>