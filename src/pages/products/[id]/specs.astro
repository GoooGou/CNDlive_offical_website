---
// src/pages/products/[id]/specs.astro
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

// âš ï¸ è¯·ç¡®è®¤ç»„ä»¶è·¯å¾„
import ProductLayout from '@/components/products/ProductLayout.astro';
import TechSpecs from '@/components/products/TechSpecs.astro';

// 1. æ‰«ææ•°æ®
const specsModules = import.meta.glob('/src/content/products/**/specs.ts', {
  eager: true,
});
const downloadsModules = import.meta.glob(
  '/src/content/products/**/downloads.ts',
  { eager: true }
);

export async function getStaticPaths() {
  const posts = await getCollection('products');
  return posts.map((post) => ({
    params: { id: post.id },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<'products'>;
}

const { post } = Astro.props;

// 2. æŸ¥æ‰¾æ•°æ®
const specKey = Object.keys(specsModules).find((path) =>
  path.includes(post.id)
);
const downloadKey = Object.keys(downloadsModules).find((path) =>
  path.includes(post.id)
);

const externalSpecs = specKey ? (specsModules[specKey] as any).specs : null;
const externalDownloads = downloadKey
  ? (downloadsModules[downloadKey] as any).downloads
  : null;

// ğŸ”¥ğŸ”¥ğŸ”¥ å…³é”®ç‚¹ï¼šè¿™ä¸ª return å¿…é¡»åœ¨ä¸Šé¢çš„ Frontmatter åŒºåŸŸ (ä¸¤ä¸ª --- ä¹‹é—´) ğŸ”¥ğŸ”¥ğŸ”¥
// å¦‚æœå½“å‰äº§å“æ²¡æœ‰ specs æ•°æ®ï¼Œç›´æ¥é‡å®šå‘
if (!externalSpecs) {
  return Astro.redirect(`/products/${post.id}`);
}
---

{/* --- ä¸‹é¢æ˜¯ HTML æ¨¡æ¿åŒºåŸŸï¼Œè¿™é‡Œé¢ç»å¯¹ä¸èƒ½å‡ºç° return --- */}

<ProductLayout
  post={post}
  activeTabId="tech-specs"
  customSpecs={externalSpecs}
  customDownloads={externalDownloads}
>
  <div class="mt-8">
    <TechSpecs data={externalSpecs} />
  </div>
</ProductLayout>
